"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
/* eslint-disable @typescript-eslint/no-unused-vars */
const devkit_1 = require("@nx/devkit");
function update(host) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projects = (0, devkit_1.getProjects)(host);
        projects.forEach((projectConfig, projectName) => {
            if (!projectConfig.targets)
                return;
            let shouldUpdate = false;
            Object.entries(projectConfig.targets).forEach(([targetName, targetConfig]) => {
                var _a, _b;
                var _c, _d;
                if (targetConfig.executor === '@nrwl/esbuild:esbuild' ||
                    targetConfig.executor === '@nx/esbuild:esbuild') {
                    (_a = (_c = projectConfig.targets[targetName]).options) !== null && _a !== void 0 ? _a : (_c.options = {});
                    if (projectConfig.targets[targetName].options.bundle !== false) {
                        shouldUpdate = true;
                        (_b = (_d = projectConfig.targets[targetName].options).thirdParty) !== null && _b !== void 0 ? _b : (_d.thirdParty = true);
                    }
                }
            });
            if (shouldUpdate) {
                (0, devkit_1.updateProjectConfiguration)(host, projectName, projectConfig);
            }
        });
        yield (0, devkit_1.formatFiles)(host);
    });
}
exports.default = update;
