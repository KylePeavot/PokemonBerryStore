"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
function update(tree) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projects = (0, devkit_1.getProjects)(tree);
        projects.forEach((projectConfig, projectName) => {
            let shouldUpdate = false;
            Object.entries(projectConfig.targets).forEach(([targetName, targetConfig]) => {
                var _a, _b;
                var _c, _d;
                if (targetConfig.executor === '@nrwl/esbuild:esbuild') {
                    shouldUpdate = true;
                    (_a = (_c = projectConfig.targets[targetName]).options) !== null && _a !== void 0 ? _a : (_c.options = {});
                    (_b = (_d = projectConfig.targets[targetName].options).generatePackageJson) !== null && _b !== void 0 ? _b : (_d.generatePackageJson = true);
                }
            });
            if (shouldUpdate) {
                (0, devkit_1.updateProjectConfiguration)(tree, projectName, projectConfig);
            }
        });
        yield (0, devkit_1.formatFiles)(tree);
    });
}
exports.default = update;
